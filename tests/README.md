# 测试框架说明

## 📁 测试目录结构

```
tests/
├── __init__.py                # 测试包初始化
├── run_tests.py              # 测试运行器 🎯
├── test_risk_manager.py      # 风险管理测试
├── test_strategies.py        # 策略测试
├── test_data.py             # 数据获取测试
└── test_schedule.py         # 定时任务测试
```

## 🚀 运行测试

### 运行所有测试
```bash
cd tests
python run_tests.py
```

### 运行快速测试
```bash
cd tests
python run_tests.py --quick
```

### 运行单个测试模块
```bash
cd tests
python test_risk_manager.py    # 风险管理测试
python test_strategies.py      # 策略测试
python test_data.py            # 数据获取测试
python test_schedule.py        # 定时任务测试
```

## 📋 测试覆盖范围

### 🛡️ 风险管理测试 (`test_risk_manager.py`)
- ✅ 仓位计算测试
- ✅ 止损功能测试
- ✅ 止盈功能测试
- ✅ 日亏损限制测试
- ✅ 投资组合风险计算
- ✅ 完整交易周期测试

### 📈 策略测试 (`test_strategies.py`)
- ✅ 均值回归策略信号生成
- ✅ 移动平均策略信号生成
- ✅ 策略对比分析
- ✅ 回测集成测试
- ✅ 真实数据集成测试

### 📊 数据获取测试 (`test_data.py`)
- ✅ 数据获取器初始化
- ✅ 股票数据获取
- ✅ 多股票数据获取
- ✅ 数据质量检查
- ✅ 数据缓存测试
- ✅ 错误处理测试

### ⏰ 定时任务测试 (`test_schedule.py`)
- ✅ Schedule模块基本功能
- ✅ 定时任务创建和执行
- ✅ 不同调度类型测试
- ✅ 任务清理功能

## 📊 测试报告示例

```
🚀 开始运行所有测试...

============================================================
运行测试: 风险管理
============================================================
==================================================
测试仓位计算
==================================================
AAPL: 133股, 投资额: $19,950.00 (20.0%)
MSFT: 66股, 投资额: $19,800.00 (19.8%)
GOOGL: 8股, 投资额: $20,000.00 (20.0%)
...
✅ 风险管理 测试完成，用时: 0.15 秒

============================================================
测试总结
============================================================
风险管理: ✅ 通过
交易策略: ✅ 通过
数据获取: ✅ 通过
定时任务: ✅ 通过

总计: 4/4 测试通过
🎉 所有测试都通过了！
```

## 🔧 添加新测试

要添加新的测试模块，请遵循以下步骤：

1. **创建测试文件**: 在 `tests/` 目录下创建 `test_xxx.py`
2. **导入项目根目录**:
   ```python
   import sys
   from pathlib import Path
   project_root = Path(__file__).parent.parent
   sys.path.insert(0, str(project_root))
   ```
3. **编写测试函数**: 创建以 `test_` 开头的函数
4. **添加主函数**: 创建 `main()` 函数来运行所有测试
5. **更新测试运行器**: 在 `run_tests.py` 中添加新测试模块

## 🎯 最佳实践

1. **测试独立性**: 每个测试应该独立运行，不依赖其他测试
2. **清理资源**: 测试后清理创建的资源（如删除临时文件）
3. **异常处理**: 测试应该包含错误情况的测试
4. **可读输出**: 使用清晰的打印语句说明测试进度
5. **快速测试**: 提供快速测试选项，避免长时间运行

## 🔍 调试测试

如果测试失败，可以：

1. **单独运行失败的测试模块**
2. **检查错误信息和堆栈跟踪**
3. **确认所有依赖模块已正确安装**
4. **验证API密钥和网络连接**

## 📝 测试输出说明

- ✅ **通过**: 测试成功执行
- ❌ **失败**: 测试执行过程中出现错误
- ⚠️ **跳过**: 测试模块无法导入或执行
- 🎉 **完成**: 所有测试都成功执行

---

💡 **提示**: 建议在每次修改代码后运行测试，确保修改没有破坏现有功能。